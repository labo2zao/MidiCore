================================================================================
MIDICORE CLI COMPILATION ERRORS - QUICK SUMMARY
================================================================================

Build Status: WILL FAIL with linker errors

Total Critical Issues: 2
Total Medium Issues: 2
Total Files Affected: 5+

================================================================================
CRITICAL ISSUE #1: router_cli.c
================================================================================

File: Services/cli/router_cli.c
Lines: End of file (290-317)

PROBLEM:
--------
Missing module_descriptor_t definition that all other CLI modules have.

ERROR MESSAGE (expected):
------------------------
undefined reference to 's_router_descriptor'

WHAT'S WRONG:
-------------
The file ends with router_cli_register() function but is missing:
- router_cli_enable() function
- router_cli_disable() function
- router_cli_get_status() function
- router_cli_init() function
- static module_descriptor_t s_router_descriptor structure

FIX:
----
Add ~35 lines to the end of router_cli.c (see ain_cli.c for example pattern)

STATUS: BLOCKS COMPILATION


================================================================================
CRITICAL ISSUE #2: metronome_cli.c
================================================================================

File: Services/cli/metronome_cli.c
Lines: 21, 29, 40, 48, 59, 67, 78, 86, 97, 105, 116, 124, 171, 270

PROBLEM:
--------
14 functions are declared/called but never implemented:

Missing Getters:
  - metronome_param_get_midi_channel() [line 21]
  - metronome_param_get_accent_note() [line 40]
  - metronome_param_get_regular_note() [line 59]
  - metronome_param_get_accent_velocity() [line 78]
  - metronome_param_get_regular_velocity() [line 97]
  - metronome_param_get_mode() [line 116]

Missing Setters:
  - metronome_param_set_midi_channel() [line 29]
  - metronome_param_set_accent_note() [line 48]
  - metronome_param_set_regular_note() [line 67]
  - metronome_param_set_accent_velocity() [line 86]
  - metronome_param_set_regular_velocity() [line 105]
  - metronome_param_set_mode() [line 124]

Missing Registration Functions:
  - setup_metronome_parameters() [line 171] - uses missing functions
  - metronome_register_cli() [line 270]

ERROR MESSAGE (expected):
------------------------
undefined reference to 'metronome_param_get_mode'
undefined reference to 'metronome_param_set_mode'
... (12 more undefined references)

WHY IT FAILS:
-------------
metronome.h does NOT provide these parameter getter/setter functions.
Only has: get_config(), set_config(), get_enabled(), set_enabled(), etc.

FIX:
----
Option 1: Implement the 14 missing functions in Services/metronome/metronome.c
Option 2: Modify metronome_cli.c to use DEFINE_PARAM_* macros
Option 3: Update metronome.c to provide proper parameter interface

STATUS: BLOCKS COMPILATION


================================================================================
MEDIUM ISSUE #1: Inconsistent Module Registration
================================================================================

Files:
  - Services/cli/ain_cli.c (line 65-67)
  - Services/cli/looper_cli.c (line 346-349)
  - Services/cli/cc_smoother_cli.c (line 108-111)

PROBLEM:
--------
Different files use different patterns for module registration

Pattern inconsistency:
  - Some use setup_X_parameters() + module_registry_register()
  - Some use just module_registry_register()
  - router_cli.c uses cli_register_command() instead

IMPACT:
-------
Possible runtime issues if initialization order matters
Code inconsistency makes maintenance harder

FIX:
----
Standardize all to use same pattern:
  1. setup_<module>_parameters() [initialize parameter table]
  2. module_registry_register(&s_<module>_descriptor) [register with system]

STATUS: Won't prevent compilation, but may cause runtime issues


================================================================================
MEDIUM ISSUE #2: Inconsistent Implementation Patterns
================================================================================

Issue:
------
Three different patterns used across CLI files:
  1. Simple pattern: DEFINE_MODULE_CONTROL_*, minimal code (ain_cli.c)
  2. Complex pattern: Manual parameter structures (looper_cli.c, metronome_cli.c)
  3. Non-standard: Pure CLI command handler, no module descriptor (router_cli.c)

IMPACT:
-------
Developers don't know which pattern to follow
Harder to add new CLI modules
Code quality suffers from inconsistency

FIX:
----
Choose one pattern and use throughout:
  - Recommended: Use DEFINE_MODULE_CONTROL_* macros from module_cli_helpers.h
  - Document the standard in a README or wiki

STATUS: Quality issue, not a blocker


================================================================================
SUMMARY TABLE
================================================================================

Error | File | Lines | Type | Severity | Blocks Compile?
------|------|-------|------|----------|----------------
#1    | router_cli.c | 290-317 | Missing descriptor | CRITICAL | YES
#2    | metronome_cli.c | 21,29,40,48... | 14 undefined funcs | CRITICAL | YES
#3    | Multiple | Various | Inconsistent registration | MEDIUM | NO
#4    | Multiple | Various | Inconsistent patterns | MEDIUM | NO

TOTAL LINKER ERRORS (if compiled now): ~15


================================================================================
WHAT TO DO NEXT (Priority Order)
================================================================================

1. CRITICAL - Fix router_cli.c
   - Add module descriptor structure (~35 lines)
   - Reference: Services/cli/ain_cli.c
   
2. CRITICAL - Fix metronome_cli.c
   - Implement 14 missing parameter getter/setter functions
   - OR modify file to use DEFINE_PARAM_* macros
   
3. HIGH - Verify registration in other files
   - Check ain_cli.c, looper_cli.c, cc_smoother_cli.c
   - Ensure all call module_registry_register()
   
4. MEDIUM - Standardize patterns
   - Pick one pattern to use everywhere
   - Refactor inconsistent files
   - Document the standard pattern

5. OPTIONAL - Add consistency checks
   - Add build-time checks for module descriptors
   - Enforce naming conventions
   - Add linting rules


================================================================================
FILES TO MODIFY
================================================================================

CRITICAL (Must fix):
  1. Services/cli/router_cli.c - Add ~35 lines
  2. Services/cli/metronome_cli.c - Add/implement functions
     OR Services/metronome/metronome.c - Add parameter interface

MEDIUM (Should fix):
  3. Services/cli/ain_cli.c - Review/standardize
  4. Services/cli/looper_cli.c - Review/standardize
  5. Services/cli/cc_smoother_cli.c - Review/standardize
  6. All other *_cli.c files - Standardize pattern

BUILD IMPACT:
  - Current state: FAILS to compile
  - After critical fixes: SHOULD compile
  - After all fixes: Best practices met


================================================================================
TECHNICAL REFERENCES
================================================================================

Module Descriptor Pattern:
  File: Services/cli/module_cli_helpers.h
  Look for: MODULE_DESCRIPTOR macro, DEFINE_MODULE_CONTROL_* macros

Standard Example:
  File: Services/cli/ain_cli.c
  This file shows the recommended pattern

Header Files:
  - Services/cli/module_cli_helpers.h - Helper macros
  - Services/module_registry/module_registry.h - Registry definitions
  - Services/cli/cli.h - CLI interface

Build System:
  Type: STM32CubeIDE with managed build system
  Look in: .cproject file for build configuration


================================================================================
Generated: 2026-01-28
Report Type: Build Error Analysis
Compiler: arm-none-eabi-gcc (when installed)
Project: MidiCore
Target: STM32F407VG
================================================================================
